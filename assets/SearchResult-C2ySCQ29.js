import{k as N,u as X,l as I,m as Z,y as ee,t as se,n as te,p as U,q as H,v as t,x as le,w as ae,z as ie,R as T,A as re,B as ue,D as ne,E as oe,F as ce,G as F,H as b,J as de,K as ve,L as he,M as me,N as ye,O as pe,Q as Ee,S as Se,T as M,U as ge,V as k}from"./app-BmhODw5S.js";const Ae=["/","/Get-Started/Coordinated-Vulnerability-Disclosure.html","/Get-Started/DMCA.html","/Get-Started/FAQ.html","/Get-Started/Feedback-and-Media-Support.html","/Get-Started/Security.html","/Get-Started/introduction.html","/en-US/","/Use-and-Play/Android%20TV%E8%AE%BE%E5%A4%87.html","/Use-and-Play/Android%E8%AE%BE%E5%A4%87.html","/Use-and-Play/Apple%20TV%E8%AE%BE%E5%A4%87.html","/Use-and-Play/MAC%E8%AE%BE%E5%A4%87.html","/Use-and-Play/Windows%E8%AE%BE%E5%A4%87.html","/Use-and-Play/iOS%E8%AE%BE%E5%A4%87.html","/en-US/Get-Started/introduction.html","/404.html","/Get-Started/","/Use-and-Play/","/en-US/Get-Started/"],fe="SLIMSEARCH_QUERY_HISTORY",p=M(fe,[]),He=()=>{const{queryHistoryCount:a}=k;return{enabled:a>0,queryHistories:p,addQueryHistory:u=>{p.value=Array.from(new Set([u,...p.value.slice(0,a-1)]))},removeQueryHistory:u=>{p.value=[...p.value.slice(0,u),...p.value.slice(u+1)]}}},D=a=>Ae[a.id]+("anchor"in a?`#${a.anchor}`:""),ke="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:B}=k,E=M(ke,[]),Re=()=>({enabled:B>0,resultHistories:E,addResultHistory:r=>{{const u={link:D(r),display:r.display};"header"in r&&(u.header=r.header),E.value=[u,...E.value.slice(0,B-1)]}},removeResultHistory:r=>{E.value=[...E.value.slice(0,r),...E.value.slice(r+1)]}}),Qe=a=>{const r=de(),u=I(),R=ve(),n=U(0),S=H(()=>n.value>0),d=he([]);return me(()=>{const{search:Q,terminate:h}=ye(),g=Ee(m=>{const{resultsFilter:w=l=>l,querySplitter:y,suggestionsFilter:L,...i}=r.value;m?(n.value+=1,Q(m,u.value,i).then(l=>w(l,m,u.value,R.value)).then(l=>{n.value-=1,d.value=l}).catch(l=>{console.warn(l),n.value-=1,n.value||(d.value=[])})):d.value=[]},k.searchDelay-k.suggestDelay,{maxWait:5e3});pe([a,u],([m])=>g(m.join(" "))),Se(()=>{h()})}),{isSearching:S,results:d}};var qe=N({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(a,{emit:r}){const u=X(),R=I(),n=Z(ee),{addQueryHistory:S,queryHistories:d,removeQueryHistory:Q}=He(),{resultHistories:h,addResultHistory:g,removeResultHistory:m}=Re(),w=se(a,"queries"),{results:y,isSearching:L}=Qe(w),i=te({isQuery:!0,index:0}),l=U(0),v=U(0),P=H(()=>d.value.length>0||h.value.length>0),q=H(()=>y.value.length>0),x=H(()=>y.value[l.value]||null),$=()=>{const{isQuery:e,index:s}=i;s===0?(i.isQuery=!e,i.index=e?h.value.length-1:d.value.length-1):i.index=s-1},O=()=>{const{isQuery:e,index:s}=i;s===(e?d.value.length-1:h.value.length-1)?(i.isQuery=!e,i.index=0):i.index=s+1},V=()=>{l.value=l.value>0?l.value-1:y.value.length-1,v.value=x.value.contents.length-1},j=()=>{l.value=l.value<y.value.length-1?l.value+1:0,v.value=0},_=()=>{v.value<x.value.contents.length-1?v.value+=1:j()},Y=()=>{v.value>0?v.value-=1:V()},C=e=>e.map(s=>ge(s)?s:t(s[0],s[1])),W=e=>{if(e.type==="customField"){const s=oe[e.index]||"$content",[o,f=""]=ce(s)?s[R.value].split("$content"):s.split("$content");return e.display.map(c=>t("div",C([o,...c,f])))}return e.display.map(s=>t("div",C(s)))},A=()=>{l.value=0,v.value=0,r("updateQuery",""),r("close")},z=()=>t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},n.value.queryHistory),d.value.map((e,s)=>t("div",{class:["slimsearch-result-item",{active:i.isQuery&&i.index===s}],onClick:()=>{r("updateQuery",e)}},[t(F,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},e),t("button",{class:"slimsearch-remove-icon",innerHTML:b,onClick:o=>{o.preventDefault(),o.stopPropagation(),Q(s)}})]))])),J=()=>t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},n.value.resultHistory),h.value.map((e,s)=>t(T,{to:e.link,class:["slimsearch-result-item",{active:!i.isQuery&&i.index===s}],onClick:()=>{A()}},()=>[t(F,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[e.header?t("div",{class:"content-header"},e.header):null,t("div",e.display.map(o=>C(o)).flat())]),t("button",{class:"slimsearch-remove-icon",innerHTML:b,onClick:o=>{o.preventDefault(),o.stopPropagation(),m(s)}})]))]));return le("keydown",e=>{if(a.isFocusing){if(q.value){if(e.key==="ArrowUp")Y();else if(e.key==="ArrowDown")_();else if(e.key==="Enter"){const s=x.value.contents[v.value];S(a.queries.join(" ")),g(s),u.push(D(s)),A()}}else if(e.key==="ArrowUp")$();else if(e.key==="ArrowDown")O();else if(e.key==="Enter"){const{index:s}=i;i.isQuery?(r("updateQuery",d.value[s]),e.preventDefault()):(u.push(h.value[s].link),A())}}}),ae([l,v],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>t("div",{class:["slimsearch-result-wrapper",{empty:a.queries.length?!q.value:!P.value}],id:"slimsearch-results"},a.queries.length?L.value?t(ie,{hint:n.value.searching}):q.value?t("ul",{class:"slimsearch-result-list"},y.value.map(({title:e,contents:s},o)=>{const f=l.value===o;return t("li",{class:["slimsearch-result-list-item",{active:f}]},[t("div",{class:"slimsearch-result-title"},e||n.value.defaultTitle),s.map((c,K)=>{const G=f&&v.value===K;return t(T,{to:D(c),class:["slimsearch-result-item",{active:G,"aria-selected":G}],onClick:()=>{S(a.queries.join(" ")),g(c),A()}},()=>[c.type==="text"?null:t(c.type==="title"?re:c.type==="heading"?ue:ne,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[c.type==="text"&&c.header?t("div",{class:"content-header"},c.header):null,t("div",W(c))])])})])})):n.value.emptyResult:P.value?[z(),J()]:n.value.emptyHistory)}});export{qe as default};
